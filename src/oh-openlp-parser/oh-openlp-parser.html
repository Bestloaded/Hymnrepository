<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../classic-theme.html">

</head><body><dom-module id="oh-openlp-parser">
  <template>
    <style include="classic-theme">
      :host {
        display: block;
      }
    </style>
  </template>
  <script>Polymer({is:"oh-openlp-parser",properties:{url:{type:String,observer:"parse"},song:{type:Object,notify:!0}},listeners:{"xml-response-loaded":"_parseXMLRequest"},parse:function(e){var r=new XMLHttpRequest;r.onload=function(){200===r.status?this.fire("xml-response-loaded",r):this.fire("xml-response-error",r)}.bind(this),r.onerror=function(){this.fire("xml-network-error",r)}.bind(this),r.open("GET",e),r.responseType="document",r.send()},_parseXMLRequest:function(e){var r=e.detail.responseXML;if(!r)return void this.fire("parsing-response-error",new Error("missing responseXML"));var o={};o.title=this._queryDom(r,"properties title"),o.author=this._queryDom(r,"properties author"),o.verses=this._getSongVerses(r),this.set("song",o)},_queryDom:function(e,r){var o=e.querySelector(r);return o?o.textContent:void this.fire("parse-error",new Error("selector "+r+" not found on the document"))},_getSongVerses:function(e){var r=e.querySelectorAll("lyrics verse");return Array.prototype.map.call(r,function(e){var r=e.querySelector("lines"),o=[];return r.childNodes.forEach(function(e){e.nodeValue&&o.push(e.nodeValue)}),o})}});</script>
</dom-module>
</body></html>